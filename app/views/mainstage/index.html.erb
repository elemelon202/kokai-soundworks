<div class="mainstage-poster">
  <%# Festival Poster Header %>
  <div class="mainstage-poster-header">
    <h1 class="mainstage-poster-title">MAINSTAGE</h1>
    <p class="mainstage-poster-subtitle">Weekly Engagement Championship</p>
    <div class="mainstage-poster-dates">
      <%= @contest.start_date.strftime('%b %d').upcase %> — <%= @contest.end_date.strftime('%b %d, %Y').upcase %>
    </div>
  </div>

  <%# Contest Type Switcher %>
  <div class="mainstage-switcher">
    <div class="mainstage-switch-btn active">
      <i class="fa-solid fa-user"></i> Musicians
    </div>
    <%= link_to band_mainstage_path, class: "mainstage-switch-btn" do %>
      <i class="fa-solid fa-users"></i> Bands
    <% end %>
  </div>

  <%# Voting Status Banner %>
  <% if current_user %>
    <% if @user_vote %>
      <div class="mainstage-vote-banner voted">
        <i class="fa-solid fa-check-circle"></i>
        You voted for <strong><%= @user_vote.name %></strong> this week!
      </div>
    <% else %>
      <div class="mainstage-vote-banner">
        <i class="fa-solid fa-hand-pointer" style="color: #E936AD;"></i>
        <span style="color: #fff;">Cast your vote for your favorite artist!</span>
      </div>
    <% end %>
  <% else %>
    <div class="mainstage-vote-banner">
      <%= link_to "Sign in", new_user_session_path, style: "color: #C8E938;" %> to vote for your favorite artist!
    </div>
  <% end %>

  <%# Festival Lineup %>
  <div class="mainstage-lineup">
    <% if @leaderboard.any? %>
      <%# Headliner - 1st Place %>
      <% headliner = @leaderboard[0] %>
      <div class="mainstage-headliner">
        <h2 class="mainstage-headliner-name">
          <%= link_to headliner[:musician].name, musician_path(headliner[:musician]) %>
        </h2>
        <div class="mainstage-headliner-score"><%= headliner[:total_score] %> PTS</div>
        <div class="mainstage-headliner-stats">
          <span class="engagement"><i class="fa-solid fa-bolt"></i> <%= headliner[:engagement_score] %> engagement</span>
          <span class="votes"><i class="fa-solid fa-hand-pointer"></i> <%= headliner[:vote_score] / 10 %> votes</span>
        </div>
        <% if current_user && !@user_vote && current_user.musician != headliner[:musician] %>
          <%= button_to mainstage_vote_path(musician_id: headliner[:musician].id), method: :post, class: "mainstage-vote-btn" do %>
            <i class="fa-solid fa-star"></i> VOTE
          <% end %>
        <% elsif @user_vote == headliner[:musician] %>
          <div class="mainstage-vote-btn voted">
            <i class="fa-solid fa-check"></i> VOTED
          </div>
        <% end %>
      </div>

      <%# Main Acts - 2nd & 3rd Place %>
      <% if @leaderboard.length > 1 %>
        <div class="mainstage-main-acts">
          <% @leaderboard[1..2].each_with_index do |entry, idx| %>
            <div class="mainstage-main-act">
              <div class="mainstage-main-act-rank <%= idx == 0 ? 'silver' : 'bronze' %>">
                <%= idx == 0 ? '★ 2ND ★' : '★ 3RD ★' %>
              </div>
              <h3 class="mainstage-main-act-name">
                <%= link_to entry[:musician].name, musician_path(entry[:musician]) %>
              </h3>
              <div class="mainstage-main-act-score"><%= entry[:total_score] %> pts</div>
              <div class="mainstage-main-act-stats">
                <i class="fa-solid fa-bolt" style="color: #C8E938;"></i> <%= entry[:engagement_score] %> ·
                <i class="fa-solid fa-hand-pointer" style="color: #E936AD;"></i> <%= entry[:vote_score] / 10 %>
              </div>
              <% if current_user && !@user_vote && current_user.musician != entry[:musician] %>
                <div class="mainstage-main-act-vote">
                  <%= button_to mainstage_vote_path(musician_id: entry[:musician].id), method: :post do %>
                    Vote
                  <% end %>
                </div>
              <% elsif @user_vote == entry[:musician] %>
                <div class="mainstage-main-act-vote">
                  <span style="color: #4ade80; font-size: 0.8rem;"><i class="fa-solid fa-check"></i> Voted</span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <%# Supporting Acts - 4th+ %>
      <% if @leaderboard.length > 3 %>
        <div class="mainstage-supporting">
          <div class="mainstage-supporting-title">— ALSO PERFORMING —</div>
          <div class="mainstage-supporting-acts">
            <% @leaderboard[3..].each do |entry| %>
              <div class="mainstage-supporting-act">
                <div class="mainstage-supporting-act-name">
                  <%= link_to entry[:musician].name, musician_path(entry[:musician]) %>
                </div>
                <div class="mainstage-supporting-act-score"><%= entry[:total_score] %> pts</div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

    <% else %>
      <div class="mainstage-empty">
        <i class="fa-solid fa-microphone-slash"></i>
        <p>No contestants yet this week.<br>Be the first to engage!</p>
      </div>
    <% end %>
  </div>

  <%# How It Works %>
  <div class="mainstage-info">
    <h3><i class="fa-solid fa-circle-info" style="color: #C8E938;"></i> How MAINSTAGE Works</h3>
    <div class="mainstage-info-grid">
      <div class="mainstage-info-card">
        <div class="title yellow">Engagement Score</div>
        <p>Earn points from followers (+5), endorsements (+3), shoutouts (+8), and short likes (+2).</p>
      </div>
      <div class="mainstage-info-card">
        <div class="title pink">Community Votes</div>
        <p>Each vote adds 10 bonus points. One vote per user per week.</p>
      </div>
      <div class="mainstage-info-card">
        <div class="title blue">Weekly Winners</div>
        <p>Top scorer gets featured on homepage and earns a MAINSTAGE winner badge!</p>
      </div>
    </div>
  </div>

  <%# Past Winners Link %>
  <div class="mainstage-past-link">
    <%= link_to mainstage_winners_path do %>
      <i class="fa-solid fa-crown"></i> View Past Winners
    <% end %>
  </div>
</div>
