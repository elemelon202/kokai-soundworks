<div id="mainstage-leaderboard">
  <div class="mainstage-leaderboard-container">
    <div class="mainstage-leaderboard-header">
      <h2 class="mainstage-leaderboard-title">
        <i class="fa-solid fa-ranking-star"></i> Leaderboard
      </h2>
      <span class="mainstage-leaderboard-update">Updated live</span>
    </div>

    <% if leaderboard.any? %>
      <div class="mainstage-leaderboard-content">
        <% leaderboard.each_with_index do |entry, index| %>
          <% musician = entry[:musician] %>
          <% rank = index + 1 %>
          <div class="leaderboard-row <%= rank <= 3 ? 'top-3' : '' %>">
            <%# Rank %>
            <div class="leaderboard-rank">
              <% if rank == 1 %>
                <i class="fa-solid fa-crown rank-gold"></i>
              <% elsif rank == 2 %>
                <i class="fa-solid fa-medal rank-silver"></i>
              <% elsif rank == 3 %>
                <i class="fa-solid fa-medal rank-bronze"></i>
              <% else %>
                <span class="rank-number"><%= rank %></span>
              <% end %>
            </div>

            <%# Avatar %>
            <div class="leaderboard-avatar">
              <% if musician.avatar.attached? %>
                <%= cl_image_tag(musician.avatar.key) %>
              <% else %>
                <div class="initials">
                  <%= musician.name[0].upcase %>
                </div>
              <% end %>
            </div>

            <%# Name and stats %>
            <div class="leaderboard-info">
              <%= link_to musician.name, musician_path(musician), class: "leaderboard-name" %>
              <div class="leaderboard-stats">
                <span class="leaderboard-stat">
                  <i class="fa-solid fa-bolt engagement"></i> <%= entry[:engagement_score] %> engagement
                </span>
                <span class="leaderboard-stat">
                  <i class="fa-solid fa-hand-pointer votes"></i> <%= entry[:vote_score] / 10 %> votes
                </span>
              </div>
            </div>

            <%# Total score %>
            <div class="leaderboard-score">
              <div class="leaderboard-score-value"><%= entry[:total_score] %></div>
              <div class="leaderboard-score-label">points</div>
            </div>

            <%# Vote button %>
            <% if current_user && !user_vote && current_user.musician != musician %>
              <%= button_to mainstage_vote_path(musician_id: musician.id), method: :post, class: "btn-vote-mainstage" do %>
                Vote
              <% end %>
            <% elsif user_vote == musician %>
              <div class="leaderboard-voted-badge">
                <i class="fa-solid fa-check"></i> Voted
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="mainstage-leaderboard-empty">
        <i class="fa-solid fa-users"></i>
        <p>No contestants yet this week. Be the first to engage!</p>
      </div>
    <% end %>
  </div>
</div>
