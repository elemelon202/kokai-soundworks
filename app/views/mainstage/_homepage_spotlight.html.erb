<%# MAINSTAGE homepage spotlight - shows both Musician and Band winners %>
<% musician_winner = MainstageWinner.recent.first %>
<% band_winner = BandMainstageWinner.recent.first %>
<% musician_contest = MainstageContest.current_contest %>
<% band_contest = BandMainstageContest.current_contest %>

<% has_musician_winner = musician_winner && musician_winner.created_at > 1.week.ago %>
<% has_band_winner = band_winner && band_winner.created_at > 1.week.ago %>

<style>
  @media (max-width: 768px) {
    .mainstage-spotlight .winner-cards-row {
      flex-direction: column !important;
    }

    .mainstage-spotlight .winner-card {
      min-width: 100% !important;
      max-width: 100% !important;
    }

    .mainstage-spotlight .winner-card-inner {
      flex-direction: column !important;
      text-align: center !important;
    }

    .mainstage-spotlight .winner-card-inner > div {
      text-align: center !important;
    }

    .mainstage-spotlight .winner-buttons {
      flex-direction: column !important;
      width: 100%;
    }

    .mainstage-spotlight .winner-buttons a {
      width: 100% !important;
      text-align: center;
    }
  }
</style>

<div class="mainstage-spotlight" style="max-width: 900px; margin: 0 auto 32px auto; padding: 0 16px;">
  <%# Show winners if we have any %>
  <% if has_musician_winner || has_band_winner %>
    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 20px;">
      <i class="fa-solid fa-trophy" style="color: #fbbf24; font-size: 1.5rem;"></i>
      <span style="color: #fbbf24; font-size: 1.3rem; font-weight: 700;">MAINSTAGE WINNERS</span>
      <i class="fa-solid fa-trophy" style="color: #fbbf24; font-size: 1.5rem;"></i>
    </div>

    <div class="winner-cards-row" style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: center;">
      <%# Musician Winner Card %>
      <% if has_musician_winner %>
        <div class="winner-card" style="flex: 1; min-width: 280px; max-width: 420px; background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%); border: 1px solid #3a3a3a; border-radius: 16px; padding: 20px; text-align: center;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 14px;">
            <i class="fa-solid fa-user" style="color: #C8E938; font-size: 1rem;"></i>
            <span style="color: #C8E938; font-size: 0.95rem; font-weight: 600;">MUSICIAN</span>
          </div>

          <div class="winner-card-inner" style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap;">
            <%# Winner avatar %>
            <div style="width: 70px; height: 70px; border-radius: 50%; background: #333; overflow: hidden; border: 3px solid #fbbf24; flex-shrink: 0;">
              <% if musician_winner.musician.avatar.attached? %>
                <%= cl_image_tag(musician_winner.musician.avatar.key, style: "width: 100%; height: 100%; object-fit: cover;") %>
              <% else %>
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #888; font-weight: 600; font-size: 1.3rem;">
                  <%= musician_winner.musician.name[0].upcase %>
                </div>
              <% end %>
            </div>

            <%# Winner info %>
            <div style="text-align: left; flex: 1; min-width: 120px;">
              <%= link_to musician_path(musician_winner.musician), style: "color: #fff; text-decoration: none; font-size: 1.2rem; font-weight: 700;" do %>
                <%= musician_winner.musician.name %>
              <% end %>
              <div style="color: #888; font-size: 0.8rem; margin-top: 2px;">
                <%= musician_winner.week_label %>
              </div>
              <div style="display: flex; gap: 12px; margin-top: 6px; flex-wrap: wrap;">
                <span style="color: #C8E938; font-size: 0.75rem;">
                  <i class="fa-solid fa-bolt"></i> <%= musician_winner.engagement_score %>
                </span>
                <span style="color: #E936AD; font-size: 0.75rem;">
                  <i class="fa-solid fa-hand-pointer"></i> <%= musician_winner.vote_score / 10 %> votes
                </span>
              </div>
            </div>

            <%# Score badge %>
            <div style="padding: 10px 16px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 10px;">
              <div style="color: #000; font-size: 1.4rem; font-weight: 800;"><%= musician_winner.final_score %></div>
              <div style="color: #000; font-size: 0.65rem; opacity: 0.8;">POINTS</div>
            </div>
          </div>

          <div class="winner-buttons" style="margin-top: 14px; display: flex; justify-content: center; gap: 10px;">
            <%= link_to musician_path(musician_winner.musician), style: "padding: 8px 18px; background: #C8E938; color: #000; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.8rem;" do %>
              View Profile
            <% end %>
            <%= link_to mainstage_path, style: "padding: 8px 18px; background: #2a2a2a; color: #fff; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 0.8rem; border: 1px solid #3a3a3a;" do %>
              Leaderboard
            <% end %>
          </div>
        </div>
      <% end %>

      <%# Band Winner Card %>
      <% if has_band_winner %>
        <div class="winner-card" style="flex: 1; min-width: 280px; max-width: 420px; background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%); border: 1px solid #3a3a3a; border-radius: 16px; padding: 20px; text-align: center;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 14px;">
            <i class="fa-solid fa-users" style="color: #E936AD; font-size: 1rem;"></i>
            <span style="color: #E936AD; font-size: 0.95rem; font-weight: 600;">BAND</span>
          </div>

          <div class="winner-card-inner" style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap;">
            <%# Winner avatar %>
            <div style="width: 70px; height: 70px; border-radius: 12px; background: #333; overflow: hidden; border: 3px solid #fbbf24; flex-shrink: 0;">
              <% if band_winner.band.banner.attached? %>
                <%= cl_image_tag(band_winner.band.banner.key, style: "width: 100%; height: 100%; object-fit: cover;") %>
              <% elsif band_winner.band.images.attached? %>
                <%= cl_image_tag(band_winner.band.images.first.key, style: "width: 100%; height: 100%; object-fit: cover;") %>
              <% else %>
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #888; font-weight: 600; font-size: 1.3rem;">
                  <%= band_winner.band.name[0].upcase %>
                </div>
              <% end %>
            </div>

            <%# Winner info %>
            <div style="text-align: left; flex: 1; min-width: 120px;">
              <%= link_to band_path(band_winner.band), style: "color: #fff; text-decoration: none; font-size: 1.2rem; font-weight: 700;" do %>
                <%= band_winner.band.name %>
              <% end %>
              <div style="color: #888; font-size: 0.8rem; margin-top: 2px;">
                <%= band_winner.week_label %>
              </div>
              <div style="display: flex; gap: 12px; margin-top: 6px; flex-wrap: wrap;">
                <span style="color: #C8E938; font-size: 0.75rem;">
                  <i class="fa-solid fa-bolt"></i> <%= band_winner.engagement_score %>
                </span>
                <span style="color: #E936AD; font-size: 0.75rem;">
                  <i class="fa-solid fa-hand-pointer"></i> <%= band_winner.vote_score / 10 %> votes
                </span>
              </div>
            </div>

            <%# Score badge %>
            <div style="padding: 10px 16px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 10px;">
              <div style="color: #000; font-size: 1.4rem; font-weight: 800;"><%= band_winner.final_score %></div>
              <div style="color: #000; font-size: 0.65rem; opacity: 0.8;">POINTS</div>
            </div>
          </div>

          <div class="winner-buttons" style="margin-top: 14px; display: flex; justify-content: center; gap: 10px;">
            <%= link_to band_path(band_winner.band), style: "padding: 8px 18px; background: #E936AD; color: #fff; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.8rem;" do %>
              View Profile
            <% end %>
            <%= link_to band_mainstage_path, style: "padding: 8px 18px; background: #2a2a2a; color: #fff; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 0.8rem; border: 1px solid #3a3a3a;" do %>
              Leaderboard
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <%# Show current contests in progress %>
    <div class="winner-cards-row" style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: center;">
      <%# Musician Contest Card %>
      <div class="winner-card" style="flex: 1; min-width: 280px; max-width: 420px; background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%); border: 1px solid #3a3a3a; border-radius: 16px; padding: 20px; text-align: center;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 10px;">
          <i class="fa-solid fa-fire" style="color: #C8E938; font-size: 1.1rem;"></i>
          <span style="color: #C8E938; font-size: 1rem; font-weight: 700;">MUSICIAN MAINSTAGE</span>
        </div>

        <p style="color: #888; font-size: 0.85rem; margin: 0 0 12px 0;">
          <%= musician_contest.start_date.strftime('%b %d') %> - <%= musician_contest.end_date.strftime('%b %d') %> &bull;
          <% days_left = (musician_contest.end_date - Date.current).to_i %>
          <span style="color: #fff;"><%= days_left %> <%= 'day'.pluralize(days_left) %> left</span>
        </p>

        <%= link_to mainstage_path, style: "display: inline-block; padding: 10px 24px; background: linear-gradient(135deg, #C8E938 0%, #a8c92e 100%); color: #000; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem;" do %>
          <i class="fa-solid fa-trophy"></i> Vote Now
        <% end %>
      </div>

      <%# Band Contest Card %>
      <div class="winner-card" style="flex: 1; min-width: 280px; max-width: 420px; background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%); border: 1px solid #3a3a3a; border-radius: 16px; padding: 20px; text-align: center;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 10px;">
          <i class="fa-solid fa-fire" style="color: #E936AD; font-size: 1.1rem;"></i>
          <span style="color: #E936AD; font-size: 1rem; font-weight: 700;">BAND MAINSTAGE</span>
        </div>

        <p style="color: #888; font-size: 0.85rem; margin: 0 0 12px 0;">
          <%= band_contest.start_date.strftime('%b %d') %> - <%= band_contest.end_date.strftime('%b %d') %> &bull;
          <% days_left = (band_contest.end_date - Date.current).to_i %>
          <span style="color: #fff;"><%= days_left %> <%= 'day'.pluralize(days_left) %> left</span>
        </p>

        <%= link_to band_mainstage_path, style: "display: inline-block; padding: 10px 24px; background: linear-gradient(135deg, #E936AD 0%, #c72990 100%); color: #fff; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem;" do %>
          <i class="fa-solid fa-trophy"></i> Vote Now
        <% end %>
      </div>
    </div>
  <% end %>
</div>
