<div id="message_form">
  <%= form_with model: [chat, message], class: "message-form", data: { turbo: true } do |f| %>
    <% if message.errors.any? %>
      <div class="errors">
        <%= message.errors.full_messages.to_sentence %>
      </div>
    <% end %>

    <div class="message-input-group">
      <%= f.text_area :content,
          placeholder: "Type your message... (Enter to send)",
          rows: 1,
          class: "message-input",
          required: true,
          data: { action: "keydown->message-form#submitOnEnter" } %>
      <%= f.submit "Send", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    setupMessageFormSubmit();
  });

  document.addEventListener("turbo:load", function() {
    setupMessageFormSubmit();
  });

  function setupMessageFormSubmit() {
    const messageInputs = document.querySelectorAll(".message-input");
    messageInputs.forEach(function(input) {
      input.addEventListener("keydown", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          const form = input.closest("form");
          if (form && input.value.trim() !== "") {
            form.requestSubmit();
          }
        }
      });
    });
  }
</script>
