<div class="mainstage-poster">
  <%# Festival Poster Header %>
  <div class="mainstage-poster-header band-header">
    <h1 class="mainstage-poster-title">BAND MAINSTAGE</h1>
    <p class="mainstage-poster-subtitle">Weekly Engagement Championship</p>
    <div class="mainstage-poster-dates">
      <%= @contest.start_date.strftime('%b %d').upcase %> — <%= @contest.end_date.strftime('%b %d, %Y').upcase %>
    </div>
  </div>

  <%# Contest Type Switcher %>
  <div class="mainstage-switcher">
    <%= link_to mainstage_path, class: "mainstage-switch-btn" do %>
      <i class="fa-solid fa-user"></i> Musicians
    <% end %>
    <div class="mainstage-switch-btn active-band">
      <i class="fa-solid fa-users"></i> Bands
    </div>
  </div>

  <%# Voting Status Banner %>
  <% if current_user %>
    <% if @user_vote %>
      <div class="mainstage-vote-banner voted">
        <i class="fa-solid fa-check-circle"></i>
        You voted for <strong><%= @user_vote.name %></strong> this week!
      </div>
    <% else %>
      <div class="mainstage-vote-banner">
        <i class="fa-solid fa-hand-pointer" style="color: #E936AD;"></i>
        <span style="color: #fff;">Cast your vote for your favorite band!</span>
      </div>
    <% end %>
  <% else %>
    <div class="mainstage-vote-banner">
      <%= link_to "Sign in", new_user_session_path, style: "color: #E936AD;" %> to vote for your favorite band!
    </div>
  <% end %>

  <%# Festival Lineup %>
  <div class="mainstage-lineup band-lineup">
    <% if @leaderboard.any? %>
      <%# Headliner - 1st Place %>
      <% headliner = @leaderboard[0] %>
      <div class="mainstage-headliner">
        <h2 class="mainstage-headliner-name">
          <%= link_to headliner[:band].name, band_path(headliner[:band]) %>
        </h2>
        <div class="mainstage-headliner-score"><%= headliner[:total_score] %> PTS</div>
        <div class="mainstage-headliner-stats">
          <span class="engagement"><i class="fa-solid fa-bolt"></i> <%= headliner[:engagement_score] %> engagement</span>
          <span class="votes"><i class="fa-solid fa-hand-pointer"></i> <%= headliner[:vote_score] / 10 %> votes</span>
        </div>
        <% user_is_member = current_user && headliner[:band].musicians.any? { |m| m.user == current_user } %>
        <% if current_user && !@user_vote && !user_is_member %>
          <%= button_to band_mainstage_vote_path(band_id: headliner[:band].id), method: :post, class: "mainstage-vote-btn" do %>
            <i class="fa-solid fa-star"></i> VOTE
          <% end %>
        <% elsif @user_vote == headliner[:band] %>
          <div class="mainstage-vote-btn voted">
            <i class="fa-solid fa-check"></i> VOTED
          </div>
        <% end %>
      </div>

      <%# Main Acts - 2nd & 3rd Place %>
      <% if @leaderboard.length > 1 %>
        <div class="mainstage-main-acts">
          <% @leaderboard[1..2].each_with_index do |entry, idx| %>
            <div class="mainstage-main-act">
              <div class="mainstage-main-act-rank <%= idx == 0 ? 'silver' : 'bronze' %>">
                <%= idx == 0 ? '★ 2ND ★' : '★ 3RD ★' %>
              </div>
              <h3 class="mainstage-main-act-name">
                <%= link_to entry[:band].name, band_path(entry[:band]) %>
              </h3>
              <div class="mainstage-main-act-score"><%= entry[:total_score] %> pts</div>
              <div class="mainstage-main-act-stats">
                <i class="fa-solid fa-bolt" style="color: #E936AD;"></i> <%= entry[:engagement_score] %> ·
                <i class="fa-solid fa-hand-pointer" style="color: #C8E938;"></i> <%= entry[:vote_score] / 10 %>
              </div>
              <% user_is_member = current_user && entry[:band].musicians.any? { |m| m.user == current_user } %>
              <% if current_user && !@user_vote && !user_is_member %>
                <div class="mainstage-main-act-vote">
                  <%= button_to band_mainstage_vote_path(band_id: entry[:band].id), method: :post do %>
                    Vote
                  <% end %>
                </div>
              <% elsif @user_vote == entry[:band] %>
                <div class="mainstage-main-act-vote">
                  <span style="color: #4ade80; font-size: 0.8rem;"><i class="fa-solid fa-check"></i> Voted</span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <%# Supporting Acts - 4th+ %>
      <% if @leaderboard.length > 3 %>
        <div class="mainstage-supporting">
          <div class="mainstage-supporting-title">— ALSO PERFORMING —</div>
          <div class="mainstage-supporting-acts">
            <% @leaderboard[3..].each do |entry| %>
              <div class="mainstage-supporting-act">
                <div class="mainstage-supporting-act-name">
                  <%= link_to entry[:band].name, band_path(entry[:band]) %>
                </div>
                <div class="mainstage-supporting-act-score"><%= entry[:total_score] %> pts</div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

    <% else %>
      <div class="mainstage-empty">
        <i class="fa-solid fa-guitar"></i>
        <p>No bands yet this week.<br>Be the first to engage!</p>
      </div>
    <% end %>
  </div>

  <%# How It Works %>
  <div class="mainstage-info">
    <h3><i class="fa-solid fa-circle-info" style="color: #E936AD;"></i> How Band MAINSTAGE Works</h3>
    <div class="mainstage-info-grid">
      <div class="mainstage-info-card">
        <div class="title pink">Engagement Score</div>
        <p>Earn points from followers (+5), profile saves (+3), gig bookings (+10), and member short likes (+2).</p>
      </div>
      <div class="mainstage-info-card">
        <div class="title yellow">Community Votes</div>
        <p>Each vote adds 10 bonus points. One vote per user per week.</p>
      </div>
      <div class="mainstage-info-card">
        <div class="title blue">Weekly Winners</div>
        <p>Top band gets featured and earns a MAINSTAGE winner badge!</p>
      </div>
    </div>
  </div>

  <%# Past Winners Link %>
  <div class="mainstage-past-link band">
    <%= link_to band_mainstage_winners_path do %>
      <i class="fa-solid fa-crown"></i> View Past Winners
    <% end %>
  </div>
</div>
