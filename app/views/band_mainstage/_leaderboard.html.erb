<div id="band-mainstage-leaderboard">
  <div style="background: #1e1e1e; border-radius: 12px; overflow: hidden;">
    <div style="padding: 16px 20px; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="color: #fff; font-size: 1.2rem; margin: 0;">
        <i class="fa-solid fa-ranking-star" style="color: #E936AD;"></i> Band Leaderboard
      </h2>
      <span style="color: #666; font-size: 0.8rem;">Updated live</span>
    </div>

    <% if leaderboard.any? %>
      <div style="padding: 8px;">
        <% leaderboard.each_with_index do |entry, index| %>
          <% band = entry[:band] %>
          <% rank = index + 1 %>
          <div class="leaderboard-row" style="display: flex; align-items: center; gap: 16px; padding: 16px; border-radius: 8px; margin-bottom: 4px; background: <%= rank <= 3 ? '#2a2a2a' : 'transparent' %>;">
            <%# Rank %>
            <div style="width: 40px; text-align: center;">
              <% if rank == 1 %>
                <i class="fa-solid fa-crown" style="color: #fbbf24; font-size: 1.5rem;"></i>
              <% elsif rank == 2 %>
                <i class="fa-solid fa-medal" style="color: #9ca3af; font-size: 1.3rem;"></i>
              <% elsif rank == 3 %>
                <i class="fa-solid fa-medal" style="color: #cd7f32; font-size: 1.3rem;"></i>
              <% else %>
                <span style="color: #666; font-size: 1.1rem; font-weight: 600;"><%= rank %></span>
              <% end %>
            </div>

            <%# Banner/Avatar %>
            <div style="width: 48px; height: 48px; border-radius: 8px; background: #333; overflow: hidden; flex-shrink: 0;">
              <% if band.banner.attached? %>
                <%= cl_image_tag(band.banner.key, style: "width: 100%; height: 100%; object-fit: cover;") %>
              <% else %>
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #888; font-weight: 600;">
                  <%= band.name[0].upcase %>
                </div>
              <% end %>
            </div>

            <%# Name and stats %>
            <div style="flex: 1; min-width: 0;">
              <%= link_to band_path(band), style: "color: #fff; text-decoration: none; font-weight: 600; font-size: 1rem;" do %>
                <%= band.name %>
              <% end %>
              <div style="display: flex; gap: 16px; margin-top: 4px;">
                <span style="color: #888; font-size: 0.8rem;">
                  <i class="fa-solid fa-bolt" style="color: #E936AD;"></i> <%= entry[:engagement_score] %> engagement
                </span>
                <span style="color: #888; font-size: 0.8rem;">
                  <i class="fa-solid fa-hand-pointer" style="color: #C8E938;"></i> <%= entry[:vote_score] / 10 %> votes
                </span>
              </div>
            </div>

            <%# Total score %>
            <div style="text-align: right; padding-right: 8px;">
              <div style="color: #E936AD; font-size: 1.3rem; font-weight: 700;"><%= entry[:total_score] %></div>
              <div style="color: #666; font-size: 0.75rem;">points</div>
            </div>

            <%# Vote button %>
            <% user_is_member = current_user && band.musicians.any? { |m| m.user == current_user } %>
            <% if current_user && !user_vote && !user_is_member %>
              <%= button_to band_mainstage_vote_path(band_id: band.id), method: :post, class: "btn-vote-mainstage", style: "padding: 8px 16px; background: #C8E938; color: #000; border: none; border-radius: 6px; font-size: 0.85rem; font-weight: 500; cursor: pointer;" do %>
                Vote
              <% end %>
            <% elsif user_vote == band %>
              <div style="padding: 8px 16px; background: #2d5a2d; color: #4ade80; border-radius: 6px; font-size: 0.85rem;">
                <i class="fa-solid fa-check"></i> Voted
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div style="padding: 40px; text-align: center; color: #666;">
        <i class="fa-solid fa-users" style="font-size: 2rem; margin-bottom: 12px; opacity: 0.3;"></i>
        <p style="margin: 0;">No bands yet this week. Be the first to engage!</p>
      </div>
    <% end %>
  </div>
</div>
