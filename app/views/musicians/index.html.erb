<div class="container musicians-index-container">
  <div class="index-heading m-3 mt-5">
    <h1 style="font-family: Impact, 'Arial Black', Haettenschweiler, sans-serif; font-size: clamp(3rem, 10vw, 6rem); font-weight: 900; letter-spacing: 2px; text-transform: uppercase; color: #000; text-shadow: 0 0 40px rgba(255, 61, 142, 0.56), 0 0 80px rgba(1, 1, 1, 0.3); margin-bottom: 8px;"><%= t('home.musicians.title') %></h1>
    <p><%= t('musicians.index.title') %></p>
    <%# DISCOVER SHORTS CTA %>
    <div class="discover-shorts-cta-wrapper">
      <%= link_to discover_shorts_path, class: "discover-shorts-cta" do %>
        <div class="discover-shorts-icon">
          <i class="fa-solid fa-play"></i>
        </div>
        <div class="discover-shorts-text">
          <span class="discover-shorts-title"><%= t('musicians.index.discover_shorts') %></span>
          <span class="discover-shorts-subtitle"><%= t('musicians.index.shorts_description') %></span>
        </div>
        <i class="fa-solid fa-arrow-right discover-shorts-arrow"></i>
      <% end %>
    </div>
  </div>
  <%= form_with url: musicians_path, method: :get, data: { turbo_frame: "musicians_list" }, class: "filters-form" do %>
    <!-- Search Field -->
    <div class="mt-5 mb-5 d-flex gap-2 align-items-center">
      <%= text_field_tag :query, params[:query], placeholder: t('musicians.index.search_placeholder'), class: "form-control", data: { action: "input->auto-submit#submit" } %>
      <%= link_to t('musicians.index.clear_filters'), musicians_path, class: "btn btn-outline-secondary" %>
      <!-- Instruments Dropdown -->
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <%= t('musicians.index.instruments') %>
        </button>
        <div class="dropdown-menu p-3" style="min-width: 200px;" data-controller="auto-submit">
          <% Musician.where.not(instrument: [nil, '']).distinct.order(:instrument).pluck(:instrument).each do |instrument| %>
            <div class="form-check">
              <%= check_box_tag "instrument[]", instrument, params[:instrument]&.include?(instrument), id: "instrument_#{instrument.parameterize}", class: "form-check-input", data: { action: "change->auto-submit#submit" } %>
              <%= label_tag "instrument_#{instrument.parameterize}", instrument, class: "form-check-label" %>
            </div>
          <% end %>
        </div>
      </div>
      <!-- Status Dropdown -->
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <%= t('musicians.index.status') %>
        </button>
        <div class="dropdown-menu p-3" style="min-width: 200px;" data-controller="auto-submit">
          <% Musician.statuses.each do |label, value| %>
            <div class="form-check">
              <%= radio_button_tag :status, value, params[:status] == value,
              id: "status_#{label}",
              class: "form-check-input",
              data: { action: "change->auto-submit#submit" } %>
              <%= label_tag "status_#{label}", label.humanize, class: "form-check-label" %>
            </div>
          <% end %>
        </div>
      </div>
      <!-- Locations Dropdown -->
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <%= t('musicians.index.locations') %>
        </button>
        <div class="dropdown-menu p-3" style="min-width: 200px;" data-controller="auto-submit">
          <% Musician.where.not(location: [nil, '']).distinct.order(:location).pluck(:location).each do |location| %>
            <div class="form-check">
              <%= check_box_tag "location[]", location, params[:location]&.include?(location), id: "location_#{location.parameterize}", class: "form-check-input", data: { action: "change->auto-submit#submit" } %>
              <%= label_tag "location_#{location.parameterize}", location, class: "form-check-label" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
  <!-- Musicians list -->
  <turbo-frame id="musicians_list">
    <div class="musicians-section" id="musicians-top"
         data-controller="horizontal-scroll"
         data-horizontal-scroll-current-page-value="<%= @pagy.page %>"
         data-horizontal-scroll-total-pages-value="<%= @pagy.pages %>"
         data-horizontal-scroll-items-per-page-value="<%= @pagy.items %>"
         data-horizontal-scroll-base-url-value="<%= musicians_path %>"
         data-horizontal-scroll-query-value="<%= params[:query] %>"
         data-horizontal-scroll-instrument-value="<%= (params[:instrument] || []).to_json %>"
         data-horizontal-scroll-location-value="<%= (params[:location] || []).to_json %>">
      <%# Page Indicator %>
      <% if @pagy.pages > 1 %>
        <nav style="display: flex; justify-content: center; margin-bottom: 20px;" data-horizontal-scroll-target="pageIndicator">
          <div style="display: flex; gap: 8px; align-items: center;">
            <% (1..@pagy.pages).each do |page_num| %>
              <button type="button"
                      data-page-number="<%= page_num %>"
                      data-action="click->horizontal-scroll#goToPage"
                style="padding: 10px 16px; background: <%= page_num == @pagy.page ? '#C8E938' : '#2a2a2a' %>; color: <%= page_num == @pagy.page ? '#000' : '#fff' %>; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; font-weight: <%= page_num == @pagy.page ? '600' : 'normal' %>;">
                <%= page_num %>
              </button>
            <% end %>
          </div>
        </nav>
        <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;" data-horizontal-scroll-target="pageInfo">
          <%= t('musicians.index.viewing_page') %> <%= @pagy.page %> / <%= @pagy.pages %>
        </p>
      <% end %>
      <div class="record-shelf-container">
        <div class="record-shelf" data-horizontal-scroll-target="shelf">
          <% if @musicians.any? %>
            <% @musicians.each do |musician| %>
              <div class="record-item" data-page="<%= @pagy.page %>">
                <div class="musician-card position-relative">
                  <%= link_to musician_path(musician), class: "text-light text-decoration-none stretched-link", data: { turbo: false } do %>
                    <div class="musician-card-header">
                      <% if musician.avatar.attached? %>
                        <%= cl_image_tag(musician.avatar.key, class: "musician-avatar") %>
                      <% elsif musician.media.attached? %>
                        <% first_file = musician.media.first %>
                        <% if first_file.content_type.start_with?("image") %>
                          <%= cl_image_tag(first_file.key, class: "musician-avatar") %>
                        <% end %>
                      <% else %>
                        <%= image_tag "musician_placeholder.jpg", class: "musician-avatar" %>
                      <% end %>
                      <div class="musician-card-name-wrapper">
                        <h4 class="musician-card-name"><%= musician.name %></h4>
                        <%= musician_status_badge(musician) %>
                      </div>
                    </div>
                    <div class="musician-card-details">
                      <p class="musician-mobile-name"><%= musician.name %></p>
                      <p><i class="fa-solid fa-location-dot"></i> <%= musician.location %></p>
                      <p><i class="fa-solid fa-guitar"></i> <%= musician.instrument %></p>
                      <p><i class="fa-solid fa-music"></i> <%= musician.styles %></p>
                      <p class="musician-bio-line"><i class="fa-solid fa-pen-to-square"></i> <%= musician.bio %></p>
                    </div>
                  <% end %>
                  <%= button_to t('common.message'), create_or_show_direct_messages_path(recipient_id: musician.user_id), method: :post, class: "btn btn-primary", style: "background-color: #a4fe35ff;", data: { turbo: false } %>
                </div>
              </div>
            <% end %>
          <% else %>
            <em><%= t('musicians.index.no_musicians') %></em>
          <% end %>
        </div>
      </div>
    </div>
  </turbo-frame>
</div>
