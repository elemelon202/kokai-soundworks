<%# Mark messages as read when chat is viewed %>
<% MessageRead.where(user_id: current_user.id, read: false)
              .where(message_id: @chat.messages.select(:id))
              .update_all(read: true) %>

<div id="band-chat" class="card p-3 mb-4" data-chat-id="<%= @chat.id %>" data-current-user-id="<%= current_user.id %>">
  <h5><%= @chat.name %></h5>

  <div id="band-messages" style="max-height: 300px; overflow-y: auto;">
    <% @messages.each do |msg| %>
      <%= render partial: "messages/message", locals: { message: msg, current_user: current_user } %>
    <% end %>
  </div>

  <form id="band-message-form" data-chat-id="<%= @chat.id %>">
    <div class="input-group mt-2">
      <input type="text" name="message[content]" class="form-control" placeholder="Type your message..." id="band-message-input" />
      <button class="btn btn-primary" type="submit">Send</button>
    </div>
  </form>
</div>
