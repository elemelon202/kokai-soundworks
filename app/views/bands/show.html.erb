<div class="band-show-container">
  <!-- Banner Section -->
  <div class="band-banner">
    <% if @band.banner.attached? %>
      <%= image_tag url_for(@band.banner), style: "object-position: center #{@band.banner_position || 50}%;" %>
    <% else %>
      <div class="banner-placeholder"></div>
    <% end %>
    <div class="banner-overlay">
      <div class="banner-content">
        <h1><%= @band.name %><% if @band.mainstage_winner? %><%= render "band_mainstage/winner_badge", band: @band %><% end %></h1>
        <div style="margin: 12px 0;">
          <%= render "bands/follow_button", band: @band %>
          <span style="color: #888; font-size: 0.9rem; margin-left: 8px;">
            <%= @band.followers.count %> <%= t('bands.show.followers') %>
          </span>
          <%= render "bands/save_button", band: @band %>
        </div>
        <% if @band.location.present? %>
          <p class="band-location"><i class="fa-solid fa-location-dot"></i> <%= @band.location %></p>
        <% end %>
        <div class="band-genres">
          <% @band.genre_list.each do |genre| %>
            <span class="genre-badge"><%= genre %></span>
          <% end %>
        </div>
        <% if current_user && current_user.id != @band.user_id %>
          <%= button_to create_or_show_direct_messages_path(recipient_id: @band.user_id), method: :post, class: "btn-message-band" do %>
            <i class="fa-solid fa-envelope"></i> <%= t('bands.show.message_band') %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="band-show-content">
    <!-- Band Info Section -->
    <div class="band-info-section">
      <div class="band-stats-row">
        <div class="band-stat">
          <i class="fa-solid fa-users"></i>
          <span><%= @band.musicians.count %> <%= t('bands.show.members') %></span>
        </div>
        <div class="band-stat">
          <i class="fa-solid fa-calendar-days"></i>
          <span><%= @band.gigs.count %> <%= @band.gigs.count == 1 ? "Gig" : "Gigs" %></span>
        </div>
      </div>
      <% if @band.description.present? %>
        <div class="band-description">
          <h3><%= t('bands.show.about') %></h3>
          <p><%= @band.description %></p>
        </div>
      <% end %>
      <!-- Band Members -->
      <div class="band-members-section">
        <h3><%= t('bands.show.members') %></h3>
        <div class="members-grid">
          <% @band.musicians.each do |musician| %>
            <div class="member-card">
              <%= link_to musician_path(musician), style: "display: flex; align-items: center; gap: 12px; text-decoration: none;" do %>
                <div class="member-avatar">
                  <% if musician.media.attached? && musician.media.first.content_type.start_with?("image") %>
                    <%= image_tag url_for(musician.media.first), class: "avatar-image" %>
                  <% else %>
                    <i class="fa-solid fa-user"></i>
                  <% end %>
                </div>
                <div class="member-info">
                  <strong><%= musician.name %></strong>
                  <span><%= musician.instrument %></span>
                </div>
                <% if musician.user_id == @band.user_id %>
                  <span class="leader-badge"><i class="fa-solid fa-crown"></i></span>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <!-- Funded Shows Section -->
    <% funded_gigs = @band.gigs.joins(:funded_gig).where('gigs.date >= ?', Date.current).where(funded_gigs: { funding_status: [:accepting_pledges, :funded, :partially_funded] }).order('gigs.date ASC').limit(3) %>
    <% if funded_gigs.any? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-hand-holding-heart" style="color: #C8E938;"></i> <%= t('bands.show.funded_shows') %></h3>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;">
          <% funded_gigs.each do |gig| %>
            <%= link_to funded_gig_path(gig.funded_gig), style: "background: #252525; padding: 16px; border-radius: 12px; display: block; text-decoration: none; transition: background 0.2s; border-left: 3px solid #C8E938;", class: "band-gig-card" do %>
              <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
                <div>
                  <h4 style="color: #fff; margin: 0 0 6px 0; font-size: 1rem;"><%= gig.name %></h4>
                  <p style="color: #888; margin: 0 0 4px 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-location-dot" style="margin-right: 4px;"></i> <%= gig.venue.name %>
                  </p>
                  <p style="color: #888; margin: 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-calendar" style="margin-right: 4px;"></i> <%= gig.date.strftime("%b %d, %Y") %>
                  </p>
                </div>
                <div style="text-align: right;">
                  <% if gig.funded_gig.accepting_pledges? %>
                    <span class="badge bg-primary" style="font-size: 0.9rem;"><%= gig.funded_gig.funding_percentage %>% funded</span>
                    <p style="color: #f39c12; margin: 4px 0 0 0; font-size: 0.75rem;"><i class="fa-solid fa-clock"></i> <%= gig.funded_gig.days_until_deadline %> days left</p>
                  <% else %>
                    <span class="badge bg-success" style="font-size: 0.9rem;">Funded!</span>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
    <!-- Upcoming Gigs Section -->
    <% upcoming_gigs = @band.gigs.where('date >= ?', Date.current).order(:date).limit(5) %>
    <% if upcoming_gigs.any? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-calendar" style="color: #C8E938;"></i> <%= t('bands.show.upcoming_gigs') %></h3>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;">
          <% upcoming_gigs.each do |gig| %>
            <%= link_to gig_path(gig), style: "background: #252525; padding: 16px; border-radius: 12px; display: block; text-decoration: none; transition: background 0.2s;", class: "band-gig-card" do %>
              <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
                <div>
                  <h4 style="color: #fff; margin: 0 0 6px 0; font-size: 1rem;"><%= gig.name %></h4>
                  <p style="color: #888; margin: 0 0 4px 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-location-dot" style="margin-right: 4px;"></i> <%= gig.venue.name %>
                  </p>
                  <p style="color: #888; margin: 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-clock" style="margin-right: 4px;"></i> <%= gig.date.strftime("%b %d, %Y") %>
                    <% if gig.start_time.present? %>
                      at <%= gig.start_time.strftime("%l:%M %p") %>
                    <% end %>
                  </p>
                </div>
                <% unless @band.musicians.include?(current_user&.musician) %>
                  <%= render "gig_attendances/buttons", gig: gig %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
    <!-- Past Gigs Section -->
    <% past_gigs = @band.gigs.where('date < ?', Date.current).order(date: :desc).limit(5) %>
    <% past_band_gigs = @band.band_gigs.where('date < ?', Date.current).order(date: :desc).limit(5) %>
    <% if past_gigs.any? || past_band_gigs.any? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-clock-rotate-left" style="color: #C8E938;"></i> <%= t('bands.show.past_gigs') %></h3>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;">
          <% past_gigs.each do |gig| %>
            <%= link_to gig_path(gig), style: "background: #252525; padding: 16px; border-radius: 12px; display: block; text-decoration: none; transition: background 0.2s; opacity: 0.8;", class: "band-gig-card" do %>
              <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
                <div>
                  <h4 style="color: #fff; margin: 0 0 6px 0; font-size: 1rem;"><%= gig.name %></h4>
                  <p style="color: #888; margin: 0 0 4px 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-location-dot" style="margin-right: 4px;"></i> <%= gig.venue.name %>
                  </p>
                  <p style="color: #888; margin: 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-calendar" style="margin-right: 4px;"></i> <%= gig.date.strftime("%b %d, %Y") %>
                  </p>
                </div>
              </div>
            <% end %>
          <% end %>
          <% past_band_gigs.each do |band_gig| %>
            <div style="background: #252525; padding: 16px; border-radius: 12px; opacity: 0.8;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
                <div>
                  <h4 style="color: #fff; margin: 0 0 6px 0; font-size: 1rem;"><%= band_gig.name %></h4>
                  <p style="color: #888; margin: 0 0 4px 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-location-dot" style="margin-right: 4px;"></i> <%= band_gig.venue_name || band_gig.location %>
                  </p>
                  <p style="color: #888; margin: 0; font-size: 0.85rem;">
                    <i class="fa-solid fa-calendar" style="margin-right: 4px;"></i> <%= band_gig.date.strftime("%b %d, %Y") %>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Band Activity/Feed Section -->
    <% band_posts = @band.posts.includes(:user, :post_likes, :post_comments, images_attachments: :blob, videos_attachments: :blob).recent.limit(10) %>
    <% if band_posts.any? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-newspaper"></i> <%= t('bands.show.activity') %></h3>
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <% band_posts.each do |post| %>
            <%= render "posts/post", post: post %>
          <% end %>
        </div>
      </div>
    <% end %>
    <!-- Photos Section -->
    <% if @band.images.attached? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-camera"></i> <%= t('bands.show.photos') %></h3>
        <div class="photos-grid">
          <% @band.images.each do |image| %>
            <div class="photo-item">
              <%= image_tag url_for(image), class: "photo-image" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <!-- Videos Section -->
    <% if @band.videos.attached? %>
      <div class="band-media-section">
        <h3><i class="fa-solid fa-video"></i> <%= t('bands.show.videos') %></h3>
        <div class="videos-grid">
          <% @band.videos.each do |video| %>
            <div class="video-item">
              <video controls>
                <source src="<%= url_for(video) %>" type="<%= video.content_type %>">
                Your browser does not support the video tag.
              </video>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <% if @band.spotify_tracks.any? %>
      <div class="band-media-section">
        <h3><i class="fa-brands fa-spotify"></i> <%= t('bands.show.music') %></h3>
        <div class="spotify-tracks-grid">
          <%= render @band.spotify_tracks %>
        </div>
      </div>
    <% end %>
  </div>
</div>
