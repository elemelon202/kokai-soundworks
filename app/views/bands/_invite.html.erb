<%= form_with model: [band, invitation], id: "new_band_invitation", class: "invite-form" do |f| %>
  <% if invitation.errors.any? %>
    <div class="invite-errors">
      <i class="fa-solid fa-circle-exclamation"></i>
      <span><%= pluralize(invitation.errors.count, "error") %> prevented this invitation:</span>
      <ul>
        <% invitation.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="invite-input-group">
    <div class="invite-select-wrapper">
      <%= f.label :musician_id, class: "invite-label" do %>
        <i class="fa-solid fa-user-music"></i> Select Musician
      <% end %>
      <% available_musicians = Musician.where.not(id: band.musician_ids).where.not(id: band.band_invitations.pending.pluck(:musician_id)) %>
      <%= f.collection_select :musician_id, available_musicians, :id, :name,
          { prompt: "Search for a musician to invite..." },
          { class: "invite-select", data: { controller: "tom-select", tom_select_placeholder_value: "Search by name..." } } %>
    </div>
    <%= f.submit "Send Invite", class: "invite-submit-btn" %>
  </div>
<% end %>
