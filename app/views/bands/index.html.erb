<div class="container bands-index-container">
  <div class="index-heading m-3 mt-5">
    <h1 style="font-family: Impact, 'Arial Black', Haettenschweiler, sans-serif; font-size: clamp(3rem, 10vw, 6rem); font-weight: 900; letter-spacing: 2px; text-transform: uppercase; color: #000; text-shadow: 0 0 40px rgba(251, 191, 36, 0.6), 0 0 80px rgba(251, 191, 36, 0.4); margin-bottom: 8px;">Bands</h1>
    <p>Discover talented bands to connect with</p>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <form class="d-flex">
          <div class="input-group dark-mode w-100">
            <%= text_field_tag :q, params[:q], class: "form-control", type: "search", placeholder: "Search for a band...", aria: { label: "Search" } %>
            <button class="btn btn-dark text-white px-4" type="submit">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="container my-4">
    <%= form_with url: bands_path, method: :get, local: true, html: { id: "band-filter-form" } do %>
      <!-- Search Input -->
      <!-- Genre Pills -->
      <div class="d-flex flex-row flex-wrap mb-3">
        <% Band::GENRES.each do |genre| %>
          <% checked = params[:genres]&.include?(genre) %>
          <%= label_tag "genre_#{genre}",
                        genre,
                        class: "btn btn-outline-dark me-2 mb-2 text-white #{'active' if checked}" do %>
            <%= check_box_tag "genres[]",
                              genre,
                              checked,
                              id: "genre_#{genre}",
                              class: "d-none",   # hide actual checkbox
                              onchange: "document.getElementById('band-filter-form').submit();" %>
            <span><%= genre %></span>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
  <!-- Display Bands -->
  <turbo-frame id="bands_list">
    <div class="bands-section"
         data-controller="horizontal-scroll"
         data-horizontal-scroll-current-page-value="<%= @pagy.page %>"
         data-horizontal-scroll-total-pages-value="<%= @pagy.pages %>"
         data-horizontal-scroll-items-per-page-value="<%= @pagy.items %>"
         data-horizontal-scroll-base-url-value="<%= bands_path %>"
         data-horizontal-scroll-query-value="<%= params[:q] %>"
         data-horizontal-scroll-genres-value="<%= (params[:genres] || []).to_json %>">
      <%# Page Indicator %>
      <% if @pagy.pages > 1 %>
        <nav style="display: flex; justify-content: center; margin-bottom: 20px;" data-horizontal-scroll-target="pageIndicator">
          <div style="display: flex; gap: 8px; align-items: center;">
            <% (1..@pagy.pages).each do |page_num| %>
              <button type="button"
                      data-page-number="<%= page_num %>"
                      data-action="click->horizontal-scroll#goToPage"
                style="padding: 10px 16px; background: <%= page_num == @pagy.page ? '#fbbf24' : '#2a2a2a' %>; color: <%= page_num == @pagy.page ? '#000' : '#fff' %>; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; font-weight: <%= page_num == @pagy.page ? '600' : 'normal' %>;">
                <%= page_num %>
              </button>
            <% end %>
          </div>
        </nav>
        <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;" data-horizontal-scroll-target="pageInfo">
          Viewing page <%= @pagy.page %> of <%= @pagy.pages %>
        </p>
      <% end %>
      <div class="record-shelf-container">
        <div class="record-shelf" data-horizontal-scroll-target="shelf">
          <% if @bands.any? %>
            <% @bands.each do |band| %>
              <div class="record-item" data-page="<%= @pagy.page %>">
                <%# BAND CARD START %>
                <div class="band-card position-relative">
                  <%= link_to band_path(band), class: "text-light text-decoration-none stretched-link", data: { turbo: false } do %>
                    <div class="band-card-header">
                      <% if band.banner.attached? %>
                        <%= image_tag url_for(band.banner), alt: band.name, class: "img-fluid" %>
                      <% else %>
                        <%= image_tag "band_placeholder.jpg", alt: band.name, class: "img-fluid rounded-5" %>
                      <% end %>
                      <div class="band-card-name-wrapper">
                      </div>
                    </div>
                    <div class="band-card-details">
                      <p><i class="fa-solid fa-location-dot"></i> <%= band.location %></p>
                      <p class="band-card-name"><%= band.name %></p>
                      <% band.genre_list.each do |genre| %>
                        <span class="badge"><%= genre %></span>
                      <% end %>
                      <p class="band-description"><i class="fa-solid fa-pen-to-square"></i> <%= band.description %></p>
                      <p><i class="fa-solid fa-user-group"></i> <%= band.musicians.count %> members</p>
                    </div>
                  <% end %>
                  <%= button_to "Message", create_or_show_direct_messages_path(recipient_id: band.user_id), method: :post, class: "btn btn-primary band-message-btn", data: { turbo: false } %>
                </div>
              </div>
            <% end %>
          <% else %>
            <em>Sorry, no bands found.</em>
          <% end %>
        </div>
      </div>
    </div>
  </turbo-frame>
</div>
