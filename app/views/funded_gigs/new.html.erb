<div class="funded-gig-form-page">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="form-card">
          <h2><i class="fa-solid fa-hand-holding-heart me-2"></i><%= t('funded_gigs.new.title') %></h2>
          <p class="text-muted mb-4"><%= t('funded_gigs.new.description') %></p>

          <%= form_with model: @funded_gig, url: venue_gig_funded_gig_path(@gig.venue, @gig), local: true do |f| %>
            <% if @funded_gig.errors.any? %>
              <div class="alert alert-danger">
                <ul class="mb-0">
                  <% @funded_gig.errors.full_messages.each do |msg| %>
                    <li><%= msg %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="gig-info-preview mb-4">
              <h5><%= t('funded_gigs.new.gig_details') %></h5>
              <p><strong><%= @gig.name %></strong></p>
              <p class="text-muted mb-1"><i class="fa-solid fa-calendar me-1"></i> <%= @gig.date.strftime('%B %d, %Y') %></p>
              <p class="text-muted"><i class="fa-solid fa-location-dot me-1"></i> <%= @gig.venue.name %></p>
            </div>

            <div class="mb-4">
              <%= f.label :funding_target_cents, t('funded_gigs.new.funding_target'), class: "form-label" %>
              <div class="input-group">
                <span class="input-group-text">Â¥</span>
                <%= f.number_field :funding_target_cents, class: "form-control form-control-lg", min: 1000, step: 1000, placeholder: "50000" %>
              </div>
              <small class="text-muted"><%= t('funded_gigs.new.funding_target_help') %></small>
            </div>

            <div class="mb-4">
              <%= f.label :deadline_days_before, t('funded_gigs.new.funding_deadline'), class: "form-label" %>
              <div class="input-group">
                <%= f.number_field :deadline_days_before, class: "form-control", min: 3, max: 30, value: 7 %>
                <span class="input-group-text"><%= t('funded_gigs.new.days_before_show') %></span>
              </div>
              <small class="text-muted"><%= t('funded_gigs.new.deadline_help') %></small>
            </div>

            <div class="mb-4">
              <%= f.label :max_bands, t('funded_gigs.new.max_bands'), class: "form-label" %>
              <%= f.number_field :max_bands, class: "form-control", min: 1, max: 10, value: 3 %>
              <small class="text-muted"><%= t('funded_gigs.new.max_bands_help') %></small>
            </div>

            <div class="mb-4">
              <div class="form-check">
                <%= f.check_box :allow_partial_funding, class: "form-check-input" %>
                <%= f.label :allow_partial_funding, t('funded_gigs.new.allow_partial_funding'), class: "form-check-label" %>
              </div>
              <small class="text-muted"><%= t('funded_gigs.new.partial_funding_help') %></small>
            </div>

            <div class="mb-4" id="partial-funding-options" style="display: none;">
              <%= f.label :minimum_funding_percent, t('funded_gigs.new.minimum_funding_percent'), class: "form-label" %>
              <div class="input-group">
                <%= f.number_field :minimum_funding_percent, class: "form-control", min: 50, max: 100, value: 80 %>
                <span class="input-group-text">%</span>
              </div>
              <small class="text-muted"><%= t('funded_gigs.new.minimum_percent_help') %></small>
            </div>

            <div class="mb-4">
              <%= f.label :venue_message, t('funded_gigs.new.message_to_fans'), class: "form-label" %>
              <%= f.text_area :venue_message, class: "form-control", rows: 4, placeholder: t('funded_gigs.new.message_placeholder') %>
            </div>

            <div class="alert alert-info">
              <h6><i class="fa-solid fa-info-circle me-2"></i><%= t('funded_gigs.new.how_it_works') %></h6>
              <ol class="mb-0 small">
                <li><%= t('funded_gigs.new.step1') %></li>
                <li><%= t('funded_gigs.new.step2') %></li>
                <li><%= t('funded_gigs.new.step3') %></li>
                <li><%= t('funded_gigs.new.step4') %></li>
                <li><%= t('funded_gigs.new.step5') %></li>
                <li><%= t('funded_gigs.new.step6') %></li>
              </ol>
            </div>

            <div class="d-grid gap-2">
              <%= f.submit t('funded_gigs.new.submit'), class: "btn btn-primary btn-lg" %>
              <%= link_to t('common.cancel'), gig_path(@gig), class: "btn btn-outline-secondary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const partialCheckbox = document.getElementById('funded_gig_allow_partial_funding');
    const partialOptions = document.getElementById('partial-funding-options');

    if (partialCheckbox) {
      partialCheckbox.addEventListener('change', function() {
        partialOptions.style.display = this.checked ? 'block' : 'none';
      });
      // Initial state
      if (partialCheckbox.checked) {
        partialOptions.style.display = 'block';
      }
    }
  });
</script>

<style>
  .funded-gig-form-page {
    background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
    min-height: 100vh;
    color: #fff;
  }

  .form-card {
    background: #1e1e2e;
    border-radius: 12px;
    padding: 2rem;
  }

  .form-card h2 {
    color: #C8E938;
  }

  .gig-info-preview {
    background: #2d2d3d;
    border-radius: 8px;
    padding: 1rem;
  }

  .form-label {
    color: #ccc;
  }

  .form-control, .form-select {
    background: #2d2d3d;
    border-color: #444;
    color: #fff;
  }

  .form-control:focus, .form-select:focus {
    background: #2d2d3d;
    border-color: #C8E938;
    color: #fff;
    box-shadow: 0 0 0 0.2rem rgba(200, 233, 56, 0.25);
  }

  .input-group-text {
    background: #444;
    border-color: #444;
    color: #ccc;
  }
</style>
