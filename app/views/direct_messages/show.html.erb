<div class="chat-container">
  <div class="chat-header">
    <% other_user = @chat.other_participant(current_user) %>
    <h1>Chat with <%= other_user&.username || "Unknown User" %></h1>
    <%= link_to "Back to Messages", direct_messages_path, class: "btn btn-secondary" %>
  </div>

  <div class="messages-wrapper">
    <div id="messages" class="messages-list">
      <% @messages.each do |message| %>
        <%= render partial: "messages/message", locals: { message: message, current_user: current_user } %>
      <% end %>
    </div>

    <%= render partial: "messages/form", locals: { chat: @chat, message: @message } %>
  </div>
</div>

<style>
  .chat-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  .chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0;
  }

  .messages-wrapper {
    background: #f9f9f9;
    border-radius: 8px;
    overflow: hidden;
  }

  .messages-list {
    min-height: 400px;
    max-height: 600px;
    overflow-y: auto;
    padding: 20px;
    background: white;
  }

  .btn-secondary {
    background: #6c757d;
    color: white;
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 4px;
  }

  .btn-secondary:hover {
    background: #5a6268;
  }
</style>

<script>
  // Auto-scroll to bottom of messages
  document.addEventListener("DOMContentLoaded", function() {
    const messagesList = document.getElementById("messages");
    if (messagesList) {
      messagesList.scrollTop = messagesList.scrollHeight;
    }
  });

  // Auto-scroll when new message is added via Turbo Stream
  document.addEventListener("turbo:before-stream-render", function(event) {
    const messagesList = document.getElementById("messages");
    if (messagesList && event.target.getAttribute("action") === "append") {
      setTimeout(() => {
        messagesList.scrollTop = messagesList.scrollHeight;
      }, 100);
    }
  });
</script>
