<div class="container mt-3">
  <h1>Edit venue</h1>
  <%= simple_form_for @venue do |f| %>
    <%= f.input :name %>
    <%= f.input :address %>
    <%= f.input :city %>
    <%= f.input :capacity %>
    <%= f.input :description %>

    <div class="mb-3">
      <%= f.label :banner, "Banner Image", class: "form-label" %>
      <% if @venue.banner.attached? %>
        <div class="mb-2">
          <%= cl_image_tag(@venue.banner.key, style: "max-width: 300px; border-radius: 8px;") %>
        </div>
      <% end %>
      <%= f.input :banner, as: :file, label: false, input_html: { accept: "image/*", class: "form-control" } %>
      <small class="text-muted">Recommended size: 1200x400px</small>
    </div>

    <div class="mb-3">
      <%= f.label :photos, "Venue Photos", class: "form-label" %>
      <% if @venue.photos.attached? %>
        <div class="d-flex flex-wrap gap-2 mb-2">
          <% @venue.photos.each do |photo| %>
            <div class="position-relative">
              <%= cl_image_tag(photo.key, style: "width: 100px; height: 100px; object-fit: cover; border-radius: 8px;") %>
              <%= link_to purge_photo_venue_path(@venue, photo_id: photo.id), method: :delete, data: { confirm: "Remove this photo?" }, class: "position-absolute top-0 end-0 bg-danger text-white rounded-circle d-flex align-items-center justify-content-center", style: "width: 20px; height: 20px; font-size: 12px; text-decoration: none;" do %>
                &times;
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      <%= f.input :photos, as: :file, label: false, input_html: { multiple: true, accept: "image/*", class: "form-control" } %>
      <small class="text-muted">You can select multiple photos (new photos will be added to existing)</small>
    </div>

    <%= f.submit class: 'btn btn-primary' %>
  <% end %>
  <%= link_to "Back to list", venues_path %>
</div>
<div class="container">
  <h1>New gig</h1>
  <%= simple_form_for [@venue, @gig] do |f| %>
    <%= f.input :name %>
    <%= f.input :date %>
    <%= f.input :start_time %>
    <%= f.input :end_time %>
    <%= f.submit class: 'btn btn-primary' %>
  <% end %>
</div>
<% upcoming_gigs = @venue.gigs.where('date >= ?', Date.current).order(:date) %>
<% if upcoming_gigs.any? %>
  <div style="background: #1e1e1e; border-radius: 16px; padding: 24px; margin-bottom: 24px;">
    <h2 style="color: #fff; margin: 0 0 20px 0; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
      <i class="fa-solid fa-calendar" style="color: #C8E938;"></i> Upcoming Gigs
    </h2>
    <div style="display: flex; flex-direction: column; gap: 16px;">
      <% upcoming_gigs.each do |gig| %>
        <div style="background: #252525; padding: 16px; border-radius: 12px;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
            <div>
              <h3 style="color: #fff; margin: 0 0 8px 0; font-size: 1.1rem;"><%= link_to gig.name, gig_path(gig), style: "text-decoration: none;" %></h3>
              <p style="color: #888; margin: 0 0 4px 0; font-size: 0.85rem;">
                <i class="fa-solid fa-clock" style="margin-right: 4px;"></i>
                <%= gig.date.strftime("%A, %B %d, %Y") %>
                <% if gig.start_time.present? %>
                  at <%= gig.start_time.strftime("%l:%M %p") %>
                <% end %>
              </p>
              <% if gig.bands.any? %>
                <p style="color: #888; margin: 0; font-size: 0.85rem;">
                  <i class="fa-solid fa-users" style="margin-right: 4px;"></i>
                  <% gig.bands.each_with_index do |band, index| %>
                    <%= link_to band.name, band_path(band), style: "color: #C8E938; text-decoration: none;" %><%= ", " unless index == gig.bands.count - 1 %>
                  <% end %>
                </p>
              <% end %>
              <% if gig.ticket_price.present? && gig.ticket_price > 0 %>
                <p style="color: #C8E938; margin: 8px 0 0 0; font-size: 0.9rem; font-weight: 600;">
                  <i class="fa-solid fa-ticket" style="margin-right: 4px;"></i>
                  $<%= number_with_precision(gig.ticket_price, precision: 2) %>
                </p>
              <% end %>
            </div>
            <%= link_to "Edit", edit_gig_path(gig), class: "btn btn-sm btn-secondary ms-2" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
