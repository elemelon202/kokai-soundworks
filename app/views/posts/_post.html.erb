<div class="mw-post-card" id="post-<%= post.id %>">
  <%# Post Header %>
  <div class="mw-post-header">
    <div class="mw-post-avatar">
      <% if post.band&.banner&.attached? %>
        <%= image_tag post.band.banner %>
      <% else %>
        <i class="fa-solid fa-users"></i>
      <% end %>
    </div>
    <div class="mw-post-info">
      <%= link_to band_path(post.band), class: "mw-post-band-name" do %>
        <%= post.band&.name || "Unknown Band" %>
      <% end %>
      <span class="mw-post-timestamp"><%= time_ago_in_words(post.created_at) %> ago</span>
    </div>
    <% if current_user.bands.include?(post.band) %>
      <%= button_to post_path(post), method: :delete, data: { confirm: "Delete this post?" }, class: "mw-post-delete" do %>
        <i class="fa-solid fa-trash"></i>
      <% end %>
    <% end %>
  </div>

  <%# Request Details %>
  <div class="mw-post-details">
    <div class="mw-detail">
      <i class="fa-solid fa-guitar"></i>
      <span class="mw-detail-label">Looking for:</span>
      <span class="mw-detail-value"><%= post.instrument&.titleize || "Not specified" %></span>
    </div>

    <div class="mw-detail">
      <i class="fa-solid fa-location-dot"></i>
      <span class="mw-detail-label">Location:</span>
      <span class="mw-detail-value"><%= post.location || "Not specified" %></span>
    </div>

    <% if post.genre.present? %>
      <div class="mw-detail">
        <i class="fa-solid fa-music"></i>
        <span class="mw-detail-label">Genre:</span>
        <span class="mw-detail-value"><%= post.genre %></span>
      </div>
    <% end %>

    <div class="mw-detail <%= post.needed_by && post.needed_by < 3.days.from_now.to_date ? 'urgent' : '' %>">
      <i class="fa-solid fa-calendar"></i>
      <span class="mw-detail-label">Needed by:</span>
      <span class="mw-detail-value">
        <%= post.needed_by ? post.needed_by.strftime("%B %d, %Y") : "ASAP" %>
        <% if post.needed_by && post.needed_by < 3.days.from_now.to_date %>
          <span class="mw-urgent-badge">URGENT</span>
        <% end %>
      </span>
    </div>
  </div>

  <%# Post Content %>
  <% if post.content.present? %>
    <div class="mw-post-content">
      <%= simple_format(post.content) %>
    </div>
  <% end %>

  <%# Post Images %>
  <% if post.images.attached? %>
    <div class="mw-post-images">
      <% post.images.each do |image| %>
        <%= image_tag url_for(image) %>
      <% end %>
    </div>
  <% end %>

  <%# Action Button %>
  <div class="mw-post-actions">
    <% if post.band && post.user != current_user %>
      <% band_leader_user = User.find_by(id: post.band.user_id) %>
      <% if band_leader_user %>
        <%= button_to create_or_show_direct_messages_path(recipient_id: band_leader_user.id), method: :post, class: "mw-dm-btn" do %>
          <i class="fa-solid fa-envelope"></i>
          Message Band
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
