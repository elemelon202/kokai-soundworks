<div class="response-card <%= 'winner' if winner %>">
  <%# Video thumbnail %>
  <div class="response-card-video">
    <% if response.musician_short.video.attached? %>
      <video controls loop playsinline muted>
        <source src="<%= url_for(response.musician_short.video) %>" type="<%= response.musician_short.video.content_type %>">
      </video>
    <% end %>
    <% if winner %>
      <span class="winner-trophy-badge">
        <i class="fa-solid fa-crown me-1"></i> WINNER
      </span>
    <% end %>
  </div>

  <div class="response-card-body">
    <%# Musician info %>
    <div class="d-flex align-items-center mb-2">
      <%= link_to musician_path(response.musician), class: "response-card-musician" do %>
        <% if response.musician.avatar.attached? %>
          <div class="response-card-avatar">
            <%= cl_image_tag(response.musician.avatar.key) %>
          </div>
        <% else %>
          <div class="response-card-avatar placeholder">
            <span><%= response.musician.name[0].upcase %></span>
          </div>
        <% end %>
        <div>
          <span class="response-card-name"><%= response.musician.name %></span>
          <p class="response-card-time"><%= response.musician.instrument %></p>
        </div>
      <% end %>
    </div>

    <%# Vote section %>
    <div class="response-card-footer">
      <span class="response-vote-count">
        <i class="fa-solid fa-fire"></i>
        <strong><%= response.votes_count %></strong> votes
      </span>

      <% challenge = response.challenge %>
      <% if challenge.open? || challenge.voting? %>
        <% if response.voted_by?(current_user) %>
          <%= button_to challenge_unvote_path(response_id: response.id), method: :delete, class: "btn-vote-response voted" do %>
            <i class="fa-solid fa-check me-1"></i> Voted
          <% end %>
        <% elsif current_user.musician != response.musician %>
          <%= button_to challenge_vote_path(response_id: response.id), method: :post, class: "btn btn-sm btn-outline-light" do %>
            <i class="fa-regular fa-heart me-1"></i> Vote
          <% end %>
        <% end %>

        <%# Creator can pick winner %>
        <% if challenge.creator == current_user.musician && (challenge.open? || challenge.voting?) %>
          <%= button_to pick_winner_challenge_path(challenge, response_id: response.id), method: :post, class: "btn btn-sm btn-pick-winner", data: { confirm: "Select this as the winner?" } do %>
            <i class="fa-solid fa-trophy me-1"></i> Pick
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
