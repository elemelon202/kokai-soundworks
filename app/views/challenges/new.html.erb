<div class="container py-4" style="max-width: 700px;">
  <%= link_to challenges_path, class: "btn btn-outline-secondary mb-4" do %>
    <i class="fa-solid fa-arrow-left me-1"></i> <%= t('common.back') %> to <%= t('challenges.index.title') %>
  <% end %>

  <div class="card" style="background: #1e1e1e; border: 1px solid #2a2a2a; border-radius: 16px;">
    <div class="card-header" style="background: linear-gradient(135deg, #E936AD 0%, #7B2D8E 100%); border: none; padding: 20px;">
      <h2 style="color: #fff; margin: 0;">
        <i class="fa-solid fa-trophy me-2"></i> <%= t('challenges.new.title') %>
      </h2>
      <p style="color: rgba(255,255,255,0.8); margin: 8px 0 0 0;">
        <%= t('challenges.new.subtitle') %>
      </p>
    </div>

    <div class="card-body" style="padding: 24px;">
      <%= form_with model: @challenge, local: true do |f| %>
        <% if @challenge.errors.any? %>
          <div class="alert alert-danger">
            <ul class="mb-0">
              <% @challenge.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="mb-4">
          <%= f.label :title, class: "form-label", style: "color: #fff;" %>
          <%= f.text_field :title, class: "form-control", style: "background: #2a2a2a; border-color: #3a3a3a; color: #fff;", placeholder: "e.g., Can You Play This Solo?" %>
          <small class="text-muted"><%= t('challenges.new.title_hint') %></small>
        </div>

        <div class="mb-4">
          <%= f.label :description, class: "form-label", style: "color: #fff;" %>
          <%= f.text_area :description, class: "form-control", rows: 3, style: "background: #2a2a2a; border-color: #3a3a3a; color: #fff;", placeholder: "Describe the challenge... What should responders do?" %>
          <small class="text-muted"><%= t('challenges.new.description_hint') %></small>
        </div>

        <div class="mb-4">
          <%= f.label :original_short_id, t('challenges.new.select_short'), class: "form-label", style: "color: #fff;" %>
          <p class="text-muted mb-3"><%= t('challenges.new.select_short_hint') %></p>

          <% if @shorts.any? %>
            <div class="row g-3">
              <% @shorts.each do |short| %>
                <div class="col-6 col-md-4">
                  <label class="d-block" style="cursor: pointer;">
                    <%= f.radio_button :original_short_id, short.id, class: "d-none", data: { short_selector: true }, checked: @challenge.original_short_id == short.id %>
                    <div class="short-option p-2" style="background: #2a2a2a; border: 2px solid #3a3a3a; border-radius: 12px; transition: all 0.2s;">
                      <div style="aspect-ratio: 9/16; background: #000; border-radius: 8px; overflow: hidden; margin-bottom: 8px;">
                        <% if short.video.attached? %>
                          <video muted preload="metadata" style="width: 100%; height: 100%; object-fit: cover;">
                            <source src="<%= url_for(short.video) %>" type="<%= short.video.content_type %>">
                          </video>
                        <% end %>
                      </div>
                      <p style="color: #fff; font-size: 0.8rem; margin: 0; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        <%= short.title %>
                      </p>
                    </div>
                  </label>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="alert" style="background: #2a2a2a; border: 1px solid #fbbf24; color: #fbbf24;">
              <i class="fa-solid fa-exclamation-triangle me-2"></i>
              <%= t('challenges.new.need_short') %>
              <%= link_to t('challenges.new.upload_short'), new_musician_short_path(current_user.musician), class: "alert-link", style: "color: #fbbf24;" %>
            </div>
          <% end %>
        </div>

        <% if @shorts.any? %>
          <div class="d-grid">
            <%= f.submit t('challenges.index.create'), class: "btn btn-lg", style: "background: #E936AD; color: #fff; font-weight: 600;" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<style>
  input[data-short-selector]:checked + .short-option {
    border-color: #E936AD !important;
    background: #3a3a3a !important;
  }
</style>
